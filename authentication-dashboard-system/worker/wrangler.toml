# Multi-Tenant SaaS Authentication API Template
# Cloudflare Worker Configuration
#
# SETUP INSTRUCTIONS:
# 1. Replace account_id with your Cloudflare account ID
# 2. Create a D1 database: wrangler d1 create your-app-database
# 3. Update database_id with the ID from step 2
# 4. Create a KV namespace: wrangler kv:namespace create RATE_LIMIT_KV
# 5. Update the KV namespace id and preview_id
# 6. Update CLIENT_URL and SERVER_URL with your domains
# 7. Set secrets in Cloudflare dashboard:
#    - wrangler secret put JWT_SECRET
#    - wrangler secret put BREVO_API_KEY
#    - wrangler secret put CORS_ORIGIN

name = "your-app-api"
compatibility_date = "2024-09-23"
account_id = "YOUR_CLOUDFLARE_ACCOUNT_ID"
main = "index.js"

# ==================== D1 DATABASE ====================
# Create: wrangler d1 create your-app-database
[[d1_databases]]
binding = "DB"
database_name = "your-app-database"
database_id = "YOUR_D1_DATABASE_ID"

# ==================== KV NAMESPACE (Rate Limiting) ====================
# Create: wrangler kv:namespace create RATE_LIMIT_KV
# Create preview: wrangler kv:namespace create RATE_LIMIT_KV --preview
[[kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "YOUR_KV_NAMESPACE_ID"
preview_id = "YOUR_KV_PREVIEW_NAMESPACE_ID"

# ==================== R2 STORAGE (Optional) ====================
# Uncomment if you need file storage
# Create: wrangler r2 bucket create your-app-data
# [[r2_buckets]]
# binding = "DATA_BUCKET"
# bucket_name = "your-app-data"

# ==================== ENVIRONMENT VARIABLES ====================
[vars]
# Non-sensitive configuration (public)
# Sensitive variables must be set as secrets in Cloudflare dashboard

# Basic configuration
JWT_EXPIRES_IN = "24h"
SESSION_TIMEOUT = "3600000"
BRAND_NAME = "Your App"
CLIENT_URL = "https://dashboard.your-domain.com"
SERVER_URL = "https://api.your-domain.com"

# Email sender configuration (optional, defaults in code)
SENDER_NAME = "Your App"
SENDER_EMAIL = "app@your-domain.com"

# Security Rate Limiting Configuration
RATE_LIMIT_LOGIN = "20"           # Max login attempts per window
RATE_LIMIT_LOGIN_WINDOW = "900"   # Window in seconds (15 min)
RATE_LIMIT_API = "100"            # Max API requests per window
RATE_LIMIT_API_WINDOW = "60"      # Window in seconds (1 min)
SESSION_IDLE_TIMEOUT = "1800000"  # Idle timeout in ms (30 min)

# ==================== PRODUCTION ENVIRONMENT ====================
[env.production]
name = "your-app-api"

[env.production.vars]
ENVIRONMENT = "production"
JWT_EXPIRES_IN = "24h"
SESSION_TIMEOUT = "3600000"
BRAND_NAME = "Your App"
CLIENT_URL = "https://dashboard.your-domain.com"
SERVER_URL = "https://api.your-domain.com"
SENDER_NAME = "Your App"
SENDER_EMAIL = "app@your-domain.com"
RATE_LIMIT_LOGIN = "20"
RATE_LIMIT_LOGIN_WINDOW = "900"
RATE_LIMIT_API = "100"
RATE_LIMIT_API_WINDOW = "60"
SESSION_IDLE_TIMEOUT = "1800000"

# D1 Database for production
[[env.production.d1_databases]]
binding = "DB"
database_name = "your-app-database"
database_id = "YOUR_D1_DATABASE_ID"

# KV Namespace for production
[[env.production.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "YOUR_KV_NAMESPACE_ID"

# ==================== PREVIEW ENVIRONMENT ====================
[env.preview]
name = "your-app-api-preview"

[env.preview.vars]
ENVIRONMENT = "preview"

# D1 Database for preview (can use same as production or separate)
[[env.preview.d1_databases]]
binding = "DB"
database_name = "your-app-database"
database_id = "YOUR_D1_DATABASE_ID"

# KV Namespace for preview
[[env.preview.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "YOUR_KV_PREVIEW_NAMESPACE_ID"
